jQuery(document).ready(function(e){if("undefined"!=typeof wp.media){var t,a=e("#meta-image-generate"),n=function(){a.find(".button").toggleClass("disabled"),a.find(".spinner").toggleClass("is-active")};a.on("click",".meta-image-fullsize",function(t){t.preventDefault();var a=e(this).find(".meta-image-preview").attr("src");if(a.length>0)return window.open(a,"_blank")}),a.on("click",".meta-image-run",function(t){t.preventDefault();var i={action:"meta_image_generate",post:a.data("post"),text:a.find(".meta-image-text").val(),contrast:a.find(".meta-image-contrast").val(),brightness:a.find(".meta-image-brightness").val()},r=e.ajax({method:"POST",url:a.data("ajaxurl"),data:i},"json");return r.done(function(e){return n(),e.success===!1?console.log(e.data):a.find(".meta-image-preview").attr("src",e.data)}),n()}),a.on("click",".meta-image-library",function(i){return i.preventDefault(),t?t.open():(t=wp.media({title:"Выберите изображение для шаринга в соцсети",multiple:!1}),t.on("select",function(){var i=t.state().get("selection").first().toJSON(),r={action:"meta_image_library",post:a.data("post"),url:i.url},o=e.ajax({method:"POST",url:a.data("ajaxurl"),data:r},"json");return o.done(function(e){return n(),e.success===!1?console.log(e.data):a.find(".meta-image-preview").attr("src",e.data)}),n()}),t.open())}),a.on("click",".meta-image-delete",function(t){t.preventDefault();var i={action:"meta_image_delete",post:a.data("post")},r=e.ajax({method:"POST",url:a.data("ajaxurl"),data:i},"json");return r.done(function(e){return n(),e.success===!1?console.log(e.data):a.find(".meta-image-preview").attr("src","")}),n()})}});